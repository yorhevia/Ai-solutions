<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Finance Solutions - Verificación de Identidad</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/stylesheets/kyc.css">
    <link rel="stylesheet" href="/stylesheets/asesor_navbar.css">
   
</head>
<body>
    <%- include('../partials/asesor_navbar') %>

    <div class="kyc-container">
        <h1><i class="fas fa-shield-alt"></i> Verificación de Identidad y Credenciales</h1>

        <% if (error_msg && error_msg.length > 0) { %>
            <div class="error-message show">
                <% if (Array.isArray(error_msg)) { %>
                    <ul>
                        <% error_msg.forEach(msg => { %>
                            <li><%= msg %></li>
                        <% }); %>
                    </ul>
                <% } else { %>
                    <%= error_msg %>
                <% } %>
            </div>
        <% } %>
        <% if (success_msg && success_msg.length > 0) { %>
            <div class="success-message show">
                <%= success_msg %>
            </div>
        <% } %>
        <% if (info_msg && info_msg.length > 0) { %>
            <div class="info-message show">
                <%= info_msg %>
            </div>
        <% } %>

        <form action="/asesor/verificar_identidad" method="POST" class="edit-card">
            <div class="tutorial-box">
                <p class="mandatory-step-title"><i class="fas fa-exclamation-circle"></i> PASO OBLIGATORIO: Subir Documentos a Google Drive/Dropbox</p>
                <p>Para garantizar la seguridad y privacidad de tus documentos, te pedimos que subas las fotos de tus documentos de identidad y credenciales profesionales a un servicio de almacenamiento en la nube como **Google Drive** o **Dropbox**.</p>
                <p>Asegúrate de configurar los enlaces como **"Cualquier persona con el enlace puede ver"** para que podamos revisarlos. Luego, pega las URLs públicas en los campos correspondientes a continuación.</p>
                <p>Si necesitas ayuda, puedes consultar:</p>
                <ul>
                    <li><a href="https://support.google.com/drive/answer/2494822?hl=es" target="_blank">Cómo compartir archivos en Google Drive</a></li>
                    <li><a href="https://help.dropbox.com/es-es/files-folders/share/create-share-link" target="_blank">Cómo crear enlaces compartidos en Dropbox</a></li>
                </ul>
            </div>
            <h2 class="form-section-title"><i class="fas fa-id-card"></i> Documentos de Identidad</h2>
            <p class="description">
                Por favor, pega las URLs de los documentos que subiste a Google Drive o Dropbox, asegurándote de que los enlaces sean compartibles públicamente para su revisión (configura "Cualquier persona con el enlace puede ver").
            </p>

            <%
            const isIdentityVerified = asesor && asesor.verification && asesor.verification.status === 'verificado';
            %>

            <% if (isIdentityVerified) { %>
                <div class="info-message show">
                    <i class="fas fa-info-circle"></i> Tu verificación de identidad ya ha sido **VERIFICADA**. No es necesario volver a enviarla.
                </div>
            <% } %>

            <fieldset>
                <div class="form-group">
                    <label for="documentType">Tipo de Documento:</label>
                    <select id="documentType" name="documentType" required>
                        <option value="">Selecciona un tipo de documento</option>
                        <option value="cedula" <%= asesor && asesor.verification && asesor.verification.documentType === 'cedula' ? 'selected' : '' %>>Cédula de Identidad</option>
                        <option value="pasaporte" <%= asesor && asesor.verification && asesor.verification.documentType === 'pasaporte' ? 'selected' : '' %>>Pasaporte</option>
                        <option value="licencia_conducir" <%= asesor && asesor.verification && asesor.verification.documentType === 'licencia_conducir' ? 'selected' : '' %>>Licencia de Conducir</option>
                        <option value="otro" <%= asesor && asesor.verification && asesor.verification.documentType === 'otro' ? 'selected' : '' %>>Otro (especificar en la nota)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="documentNumber">Número de Documento:</label>
                    <input type="text" id="documentNumber" name="documentNumber" placeholder="Número de identificación único" value="<%= asesor && asesor.verification && asesor.verification.documentNumber || '' %>" required <%= isIdentityVerified ? 'readonly' : '' %>>
                </div>

                <div class="form-group">
                    <label for="frontPhotoUrl">URL Foto Frontal del Documento:</label>
                    <input type="url" id="frontPhotoUrl" name="frontPhotoUrl" placeholder="Pega aquí el enlace de Google Drive/Dropbox para la foto frontal" value="<%= asesor && asesor.verification && asesor.verification.photos && asesor.verification.photos.front || '' %>" required <%= isIdentityVerified ? 'readonly' : '' %>>
                    <small>Ej: `https://drive.google.com/file/d/ABCD123xyz/view?usp=sharing`</small>
                </div>

                <div class="form-group">
                    <label for="backPhotoUrl">URL Foto Trasera del Documento (si aplica):</label>
                    <input type="url" id="backPhotoUrl" name="backPhotoUrl" placeholder="Pega aquí el enlace de Google Drive/Dropbox para la foto trasera" value="<%= asesor && asesor.verification && asesor.verification.photos && asesor.verification.photos.back || '' %>" <%= isIdentityVerified ? 'readonly' : '' %>>
                    <small>Opcional para algunos documentos.</small>
                </div>

                <div class="form-group">
                    <label for="selfiePhotoUrl">URL Selfie con Documento:</label>
                    <input type="url" id="selfiePhotoUrl" name="selfiePhotoUrl" placeholder="Pega aquí el enlace de Google Drive/Dropbox para tu selfie con el documento" value="<%= asesor && asesor.verification && asesor.verification.photos && asesor.verification.photos.selfie || '' %>" required <%= isIdentityVerified ? 'readonly' : '' %>>
                    <small>Tu rostro debe ser visible y el documento legible.</small>
                </div>
            </fieldset>

            <h2 class="form-section-title"><i class="fas fa-graduation-cap"></i> Credenciales Profesionales</h2>
            <p class="description">Por favor, pega las URLs de tus documentos profesionales (título, certificaciones) subidos a Google Drive o Dropbox.</p>

            <%
            const isTituloVerified = asesor && asesor.verificacion && asesor.verificacion.titulo && asesor.verificacion.titulo.estado === 'verificado';
            const isCertificacionVerified = asesor && asesor.verificacion && asesor.verificacion.certificacion && asesor.verificacion.certificacion.estado === 'verificado';
            %>

            <% if (isTituloVerified) { %>
                <div class="info-message show">
                    <i class="fas fa-info-circle"></i> Tu título universitario ya ha sido **VERIFICADO**.
                </div>
            <% } %>
            <fieldset> 
                <div class="form-group">
                    <label for="tituloUniversitarioUrl">URL Título Universitario:</label>
                    <input type="url" id="tituloUniversitarioUrl" name="tituloUniversitarioUrl" placeholder="Pega aquí el enlace de Google Drive/Dropbox para tu título" value="<%= asesor && asesor.verificacion && asesor.verificacion.titulo && asesor.verificacion.titulo.urlDocumento || '' %>" required <%= isTituloVerified ? 'readonly' : '' %>>
                </div>
            </fieldset>

            <% if (isCertificacionVerified) { %>
                <div class="info-message show">
                    <i class="fas fa-info-circle"></i> Tu certificación profesional ya ha sido **VERIFICADA**.
                </div>
            <% } %>
            <fieldset> 
                <div class="form-group">
                    <label for="certificacionProfesionalUrl">URL Certificación Profesional (Opcional):</label>
                    <input type="url" id="certificacionProfesionalUrl" name="certificacionProfesionalUrl" placeholder="Pega aquí el enlace de Google Drive/Dropbox para tu certificación" value="<%= asesor && asesor.verificacion && asesor.verificacion.certificacion && asesor.verificacion.certificacion.urlDocumento || '' %>" <%= isCertificacionVerified ? 'readonly' : '' %>>
                </div>
            </fieldset>

            <div class="form-group">
                <label for="notes">Notas Adicionales (Opcional):</label>
                <textarea id="notes" name="notes" rows="3" placeholder="Ej. si el documento es 'Otro', especifica aquí... o cualquier aclaración sobre tus documentos." <%= isIdentityVerified ? 'readonly' : '' %>><%= asesor && asesor.verification && asesor.verification.notes || '' %></textarea>
            </div>

            <% if (!isIdentityVerified || !isTituloVerified || !isCertificacionVerified) { %>
                <div class="button-group">
                    <button type="submit" class="save-button"><i class="fas fa-paper-plane"></i> Enviar para Verificación</button>
                    <a href="/perfilasesor" class="cancel-button"><i class="fas fa-times-circle"></i> Cancelar</a>
                </div>
            <% } else { %>
                <div class="info-message show full-width">
                    <i class="fas fa-check-double"></i> Todas tus credenciales han sido **VERIFICADAS**. Puedes volver a tu <a href="/perfilasesor">perfil</a>.
                </div>
                <div class="button-group">
                    <a href="/perfilasesor" class="cancel-button"><i class="fas fa-times-circle"></i> Volver al Perfil</a>
                </div>
            <% } %>

            <div class="privacy-note">
                <p>Tu información será tratada con la máxima confidencialidad y solo se utilizará para fines de verificación de identidad y credenciales. Para más detalles, consulta nuestra <a href="/politica-privacidad">Política de Privacidad</a>.</p>
            </div>
        </form>
    </div>

    <footer class="main-footer">
        <div class="footer-content">
            <p>&copy; 2025 AI Finance Solutions. Todos los derechos reservados.</p>
            <p>Crecimiento inteligente para tus finanzas.</p>
        </div>
    </footer>
</body>
</html>
